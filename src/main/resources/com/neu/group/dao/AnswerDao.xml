<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neu.group.dao.AnswerDao">

    <resultMap id="findeByidBymapcheck" type="com.neu.group.domain.Answer"><!--  type就写返回的模型的名称-->
        <!--下面第一行是主键-->
        <id column="id" property="id"></id>
        <!--properties是实体类中真实的属性，column是别名-->
        <result column="qn_id" property="qnId"></result>
        <result column="qn_name" property="qnName"></result>
        <result column="q_id" property="qId"></result>
        <result column="user_id" property="userId"></result>
        <result column="user_name" property="userName"></result>
        <result column="create_time" property="createTime"></result>
        <result column="content" property="content"></result>
        <result column="choice" property="choice"></result>
        <result column="columns" property="columns"></result>
        <result column="score" property="score"></result>

    </resultMap>

    <insert id="createAnswer">
        insert into answer(id, qn_id, qn_name, q_id, user_id, user_name, create_time, type)
        values (#{id}, #{qnId}, #{qnName}, #{qId},
                #{userId}, #{userName}, #{createTime}, #{type})
    </insert>

    <insert id="createAnswerChoice">
        insert into answer_choice(id, choice)
        values (#{id}, #{choice})
    </insert>

    <insert id="createAnswerMatrix">
        insert into answer_matrix(id, choice, columns)
        values (#{id}, #{choice}, #{columns})
    </insert>

    <insert id="createAnswerBlank">
        insert into answer_blank(id, content)
        values (#{id}, #{content})
    </insert>

    <insert id="createAnswerScale">
        insert into answer_scale(id, choice, score)
        values (#{id}, #{choice}, #{score})
    </insert>

    <select id="selectAnswer" resultMap="findeByidBymapcheck">
        select *
        from answer
        where qn_id = #{qn_id} and user_id = #{userId}
        order by q_id
    </select>

    <select id="selectAnswerOptionById" resultType="com.neu.group.domain.SingleAnswer">
        select case
                   when #{type} = 1 and #{type} = 2 then (select * from answer_choice where id = #{id})
                   when #{type} = 3 then (select * from answer_blank where id = #{id})
                   when #{type} = 4 then (select * from answer_matrix where id = #{id})
                   when #{type} = 5 then (select * from answer_scale where id = #{id})
                   end;
    </select>

    <select id="selectAnswerByUser" resultMap="findeByidBymapcheck">
        SELECT *
        FROM answer
        WHERE (qn_id, user_id) IN (
            SELECT qn_id, user_id
            FROM answer
            GROUP BY qn_id
        );
    </select>

</mapper>